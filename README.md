# EndStone ARC Core Plugin

## 概述

EndStone ARC Core 是一个功能完整的 EndStone (Minecraft 基岩版服务器) 插件，为服务器提供全方位的核心功能模块。该插件包含玩家管理、经济系统、领地管理、传送系统、公告系统、清道夫系统等丰富功能，是构建现代化 Minecraft 服务器的理想选择。

## 作者信息

- **作者**: DEVILENMO
- **邮箱**: DEVILENMO@gmail.com
- **版本**: 1.0.0
- **API 版本**: 0.7+

## ✨ 主要功能

### 🗄️ 数据库管理
- 基于 SQLite 的高性能数据库支持
- 线程安全的数据库连接管理
- 自动创建数据库文件和目录
- 支持复杂查询和事务处理

### 🌍 多语言支持
- 完整的国际化系统
- 动态语言文件加载
- 默认支持中文 (ZH-CN)
- 可扩展其他语言包

### 👤 玩家管理系统
- 密码认证登录系统
- 玩家数据持久化存储
- 在线状态实时管理
- 玩家加入/离开消息提示

### 💰 银行经济系统
- 完整的货币管理系统
- 玩家余额存储和查询
- 玩家间转账功能
- 富豪榜排行系统
- 管理员金钱操作命令
- 实时余额变动提醒

### 🏠 领地管理系统
- 矩形领地圈地功能
- 领地保护机制（防止破坏/建造）
- 领地买卖系统
- **领地移交功能** - 可将领地转移给其他玩家
- 领地传送点设置
- 领地重命名功能
- 可配置的领地价格和最小距离

### 📍 传送系统
- **私人传送点 (Home)** - 玩家可设置多个传送点
- **公共传送点 (Warp)** - 管理员可创建公共传送点
- **玩家传送请求 (TPA/TPHERE)** - 玩家间传送请求系统
- **死亡回归系统** - 玩家死亡后可传送回死亡地点
- 跨维度传送检测
- 传送倒计时提示

### 📢 公告系统 (新增)
- 定时循环播放公告消息
- 支持多条公告轮播
- **动态占位符支持**：
  - `{date}` - 当前日期 (年-月-日)
  - `{time}` - 当前时间 (小时:分钟)
  - `{online_player_number}` - 当前在线玩家数
- 可配置公告发送间隔
- 从 `broadcast.txt` 文件读取公告内容

### 🧹 清道夫系统 (新增)
- 定时自动清理掉落物
- 可配置清理时间间隔
- 清理前10秒倒计时警告
- 清理过程状态提示
- 可通过配置开启/关闭

### 🛡️ 出生点保护
- 可配置的出生点保护范围
- 防止玩家在出生点附近建筑/破坏
- 多维度出生点支持

### ⚙️ OP 管理面板
- 游戏模式切换
- 手动触发掉落物清理
- 坐标记录功能
- 命令执行面板

## 命令列表

| 命令 | 描述 | 权限 | 用法 |
|------|------|------|------|
| `/arc` | 打开 ARC Core 主菜单 | `arc_core.command.arc` | `/arc` |
| `/updatespawnpos` | 更新当前维度的出生点位置 | 默认 | `/updatespawnpos` |
| `/suicide` | 自杀命令 | `arc_core.command.suicide` | `/suicide` |
| `/spawn` | 传送到出生点 | `arc_core.command.spawn` | `/spawn` |
| `/addmoney` | 为玩家添加金钱 (仅OP) | 默认 | `/addmoney [玩家名] [数量]` |
| `/removemoney` | 从玩家扣除金钱 (仅OP) | 默认 | `/removemoney [玩家名] [数量]` |
| `/pos1` | 设置土地边界点1 | `arc_core.command.set_land_corner` | `/pos1` |
| `/pos2` | 设置土地边界点2 | `arc_core.command.set_land_corner` | `/pos2` |

## 权限系统

| 权限节点 | 描述 | 默认值 |
|----------|------|---------|
| `arc_core.command.arc` | 使用主菜单命令 | true |
| `arc_core.command.suicide` | 使用自杀命令 | true |
| `arc_core.command.spawn` | 使用出生点传送 | true |
| `arc_core.command.set_land_corner` | 设置土地边界 | true |

## 📂 文件结构

插件会在 `plugins/ARCCore/` 目录下创建以下文件：

- `core_setting.yml` - 主要配置文件
- `broadcast.txt` - 公告消息文件
- `{语言代码}.txt` - 语言文件 (如 ZH-CN.txt)
- SQLite 数据库文件

## ⚙️ 配置文件

### core_setting.yml - 主要配置选项

```yaml
# 基础设置
DEFAULT_LANGUAGE_CODE=ZH-CN          # 默认语言
DATABASE_PATH=ARCCore.db             # 数据库文件路径
PLAYER_INIT_MONEY_NUM=10000          # 玩家初始金钱

# 出生点保护
IF_PROTECT_SPAWN=True                # 是否保护出生点
SPAWN_PROTECT_RANGE=8                # 出生点保护范围

# 领地系统
MIN_LAND_DISTANCE=1                  # 领地最小距离
LAND_PRICE=1000                      # 领地价格 (每格)
LAND_SELL_REFUND_COEFFICIENT=0.9     # 领地出售退款系数

# 传送系统
MAX_PLAYER_HOME_NUM=5                # 玩家最大家园数量

# 公告系统
BROADCAST_INTERVAL=180               # 公告发送间隔 (秒)

# 清道夫系统
ENABLE_CLEANER=True                  # 是否启用清道夫
CLEANER_INTERVAL=600                 # 清理间隔 (秒)
```

### broadcast.txt - 公告消息文件

每行一条公告，支持占位符：

```txt
欢迎来到ARC弧光基岩服务器！你可以在聊天框发送/arc命令打开服务器操作菜单
请遵守服务器规则，文明游戏，共建和谐游戏环境！
现在是北京时间{date} {time}，请注意休息，爱护眼睛你我做起。
当前服务器在线人数{online_player_number}，求生者们请互帮互助
```

### 支持的占位符

| 占位符 | 描述 | 示例输出 |
|--------|------|----------|
| `{date}` | 当前日期 | `2024-01-15` |
| `{time}` | 当前时间 | `14:30` |
| `{online_player_number}` | 在线玩家数 | `5` |

## 安装说明

1. 确保您的服务器运行 EndStone 框架
2. 将插件文件放入服务器的 `plugins` 目录
3. 重启服务器或使用插件管理命令加载
4. 插件会自动创建必要的配置文件和数据库

## 依赖要求

- EndStone 框架 (API 版本 0.7+)
- Python 3.x
- SQLite3 (通常内置于 Python)

## 🎮 使用指南

### 快速开始
1. 玩家进入服务器后，使用 `/arc` 命令打开主菜单
2. 首次使用需要注册账户并设置密码
3. 登录后可使用各种功能：银行、领地、传送等

### 功能操作指南
- **银行系统**: 在主菜单点击"银行"进行转账、查看余额等
- **领地系统**: 使用 `/pos1` 和 `/pos2` 设置领地边界，然后在菜单中购买
- **传送系统**: 在主菜单的"传送系统"中管理传送点和发送传送请求
- **公告查看**: 定时播放的公告会自动显示当前时间和在线人数

## 🗃️ 数据存储

插件使用 SQLite 数据库存储以下数据：
- **玩家信息**: 用户名、UUID、密码哈希、注册时间
- **经济数据**: 玩家余额、交易记录
- **领地信息**: 领地坐标、拥有者、传送点、共享用户
- **传送点**: 私人传送点、公共传送点坐标信息
- **服务器配置**: 出生点坐标、系统设置

## 🛠️ 开发信息

### 项目结构
```
EndStone-ARC-CORE/
├── src/endstone_arc_core/
│   ├── __init__.py              # 插件初始化
│   ├── arc_core_plugin.py       # 主插件类 (2800+ 行代码)
│   ├── DatabaseManager.py       # 数据库管理器
│   ├── LanguageManager.py       # 语言管理器
│   └── SettingManager.py        # 设置管理器
├── dist/ARCCore/
│   ├── core_setting.yml         # 配置文件
│   ├── broadcast.txt            # 公告文件
│   └── ZH-CN.txt               # 中文语言包
└── pyproject.toml              # 项目配置
```

### 核心技术特性
- **线程安全**: 数据库操作完全线程安全
- **事件驱动**: 基于 EndStone 事件系统
- **定时任务**: 使用 Scheduler 实现定时功能
- **模块化设计**: 各功能模块独立，易于维护
- **动态配置**: 支持运行时配置重载

### API 兼容性
- **EndStone API**: 0.7+
- **Python**: 3.8+
- **数据库**: SQLite 3.x

## 📈 性能特性

- **高效的区块索引**: 领地系统使用区块映射，快速定位
- **内存优化**: 合理的缓存策略，减少数据库查询
- **异步处理**: 耗时操作使用定时任务处理
- **资源清理**: 自动清理过期的传送请求和临时数据

## 🔒 安全特性

- **密码保护**: 玩家密码使用 SHA-256 哈希存储
- **权限系统**: 基于 EndStone 权限系统
- **输入验证**: 所有用户输入都经过严格验证
- **SQL 注入防护**: 使用参数化查询

## 📄 许可证

本项目采用开源许可证，详见 LICENSE 文件。

## 🤝 支持与反馈

- **作者邮箱**: DEVILENMO@gmail.com
- **问题反馈**: 请详细描述问题和复现步骤
- **功能建议**: 欢迎提供改进建议

## 📋 更新日志

### v1.0.0 (当前版本)
- ✅ 完整的玩家管理和认证系统
- ✅ 银行经济系统（转账、富豪榜）
- ✅ 领地管理系统（圈地、保护、移交）
- ✅ 传送系统（Home、Warp、TPA、死亡回归）
- ✅ 公告系统（定时播放、动态占位符）
- ✅ 清道夫系统（定时清理掉落物）
- ✅ 出生点保护系统
- ✅ OP 管理面板
- ✅ 多语言支持 (ZH-CN)
- ✅ 完整的 GUI 界面

### 计划中的功能
- 🔄 商店系统
- 🔄 更多语言包支持
- 🔄 数据备份和恢复
- 🔄 API 接口供其他插件调用

---

*ARC Core 是一个功能完整、性能优异的 EndStone 插件，为服务器管理者提供了一站式的解决方案。*